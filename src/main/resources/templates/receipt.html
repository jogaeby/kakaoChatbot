<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>예스크린 - 접수내역</title>
        <link rel="stylesheet" th:href="@{/css/styles.css}">
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <style>
            .carousel-inner img {
                cursor: pointer;
            }
            @media (max-width: 768px) {
                #imageCarousel img {
                    max-height: 50vh;
                }
                .modal-body img {
                    max-height: 90vh;
                }
            }

            .carousel-control-prev-icon,
            .carousel-control-next-icon {
                background-color: rgba(0, 0, 0, 0.5); /* 회색 배경 */
                border-radius: 50%;
            }
            .image-clickable:hover {
                opacity: 0.85;
            }

            .btn-close-red {
                background-color: rgba(255, 0, 0, 0.8); /* 반투명 빨강 */
                border: 2px solid red; /* 빨간 테두리 */
                border-radius: 50%;
                width: 2.5rem;
                height: 2.5rem;
                position: relative;
                cursor: pointer;
                opacity: 1;
                transition: background-color 0.3s ease, border-color 0.3s ease;
            }

            .btn-close-red::before, .btn-close-red::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 1.5rem;
                height: 2px;
                background-color: white;
                transform-origin: center;
            }

            .btn-close-red::before {
                transform: translate(-50%, -50%) rotate(45deg);
            }

            .btn-close-red::after {
                transform: translate(-50%, -50%) rotate(-45deg);
            }

            .btn-close-red:hover {
                background-color: rgba(255, 0, 0, 1);
                border-color: darkred;
            }

            #loadingOverlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(255, 255, 255, 0.5);
                z-index: 9999;
            }

            #loadingOverlay img {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

        </style>
    </head>
    <body class="bg-primary">
        <div id="layoutAuthentication">
            <div id="layoutAuthentication_content" style="background-color: snow !important; align-content: center" >
                <main>
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-5 mb-5">
                                <div class="card shadow-lg border-0 rounded-lg mt-5">
                                    <div class="card-body">
                                        <div class="form-floating mb-3">

                                            <!-- 카테고리 -->
                                            <div class="mb-4 d-flex justify-content-center" th:if="${title}">
                                                <h2 th:text="${title}"></h2>
                                            </div>
                                            <span id="type" th:text="${type}" hidden="hidden"></span>
                                            <!-- 기본 정보 -->
                                            <div class="mb-2" th:if="${receiptId}">접수번호: <span id="receiptId" th:text="${receiptId}"></span></div>
                                            <div class="mb-2" th:if="${brandName}">브랜드: <span id="brandName" th:text="${brandName}"></span></div>
                                            <div class="mb-2" th:if="${branchName}">지점: <span id="branchName" th:text="${branchName}"></span></div>
                                            <div class="mb-2" th:if="${managerName}">담당자: <span id="managerName" th:text="${managerName}"></span></div>
                                            <div class="mb-4" th:if="${receiptDateTime}">접수일자: <span is="receiptDateTime" th:text="${receiptDateTime}"></span></div>

                                            <!-- 구분선 (문의사항 또는 증상 존재 시) -->
<!--                                            <div th:if="${inquiries != null or symptom != null}" style="width: 100%; height: 2px; background-color: black; margin: 20px 0;"></div>-->

                                            <!-- 문의사항/증상 -->
                                            <div class="mb-4" th:if="${comment}">건의사항: <span id="inquiries" th:text="${comment}"></span></div>

                                            <!-- 이미지 슬라이드 -->
                                            <div id="imageCarousel" class="carousel slide mb-4" data-bs-ride="carousel" th:if="${imageUrls}">
                                                <div>접수 이미지</div>
                                                <div class="carousel-inner">
                                                    <div class="carousel-item position-relative"
                                                         th:each="url, stat : ${imageUrls}"
                                                         th:classappend="${stat.index == 0} ? ' active'">

                                                        <!-- 클릭 시 모달 오픈 -->
                                                        <img th:src="${url}"
                                                             class="d-block w-100 img-fluid image-clickable"
                                                             th:attr="data-bs-toggle='modal', data-bs-target='#imageModal', data-img-url=${url}"
                                                             style="max-height: 60vh; object-fit: contain; border: 1px solid #ddd;">

                                                        <!-- 순서 표시 -->
                                                        <div class="position-absolute bottom-0 end-0 p-1 px-2 text-white bg-dark bg-opacity-50 rounded fs-6">
                                                            <span th:text="${stat.index + 1} + ' / ' + ${imageUrls.size()}"></span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 이전/다음 버튼 -->
                                                <button class="carousel-control-prev" type="button" data-bs-target="#imageCarousel" data-bs-slide="prev">
                                                    <span class="carousel-control-prev-icon"></span>
                                                    <span class="visually-hidden">이전</span>
                                                </button>
                                                <button class="carousel-control-next" type="button" data-bs-target="#imageCarousel" data-bs-slide="next">
                                                    <span class="carousel-control-next-icon"></span>
                                                    <span class="visually-hidden">다음</span>
                                                </button>
                                            </div>

                                            <!-- ✅ 확대보기 모달 -->
                                            <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
                                                <div class="modal-dialog modal-fullscreen-sm-down modal-dialog-centered">
                                                    <div class="modal-content bg-black border-0">
                                                        <!-- 닫기 버튼 -->
                                                        <div class="modal-header border-0">
                                                            <button type="button" class="btn-close-red ms-auto me-2" data-bs-dismiss="modal" aria-label="닫기"></button>
                                                        </div>
                                                        <div class="modal-body p-0 text-center">
                                                            <img id="modalImage" src="" class="img-fluid w-100 h-auto" style="object-fit: contain;" alt="확대 이미지">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 이미지 첨부 input -->
                                            <div class="mb-4" th:if="${status == '접수'}">
                                                <label for="imageUpload" class="form-label">사진 첨부 (최대 10장까지 가능)</label>
                                                <input type="file" id="imageUpload" accept="image/*" multiple class="form-control" />
                                            </div>

                                            <!-- 상태 메시지 -->
                                            <div class="mb-4" th:if="${status == '조치완료'}" style="color: red; font-weight: bold;">
                                                이미 조치완료된 접수내역입니다.<br>
                                                완료일시: <span th:text="${completedDateTime}"></span>
                                            </div>
                                        </div>

                                        <!-- 배정 버튼 -->
                                        <div class="d-flex justify-content-center gap-2 mt-4 mb-0">
                                            <button class="btn btn-primary" id="quotation" type="button" th:if="${status == '접수'}" onclick="executeAssign()">조치완료</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
                <div id="loadingOverlay">
                    <img src="/loading.gif" alt="로딩 중...">
                </div>
            </div>
            <div id="layoutAuthentication_footer">
                <th:block th:replace="fragments/footer :: footer"></th:block>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script th:src="@{/js/scripts.js}"></script>
        <script th:src="@{/js/view/receipt/receipt.js}"></script>
    </body>
</html>
